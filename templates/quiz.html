{% extends "base.html" %}

{% block title %}Cr√™perie ‚Äî Quick English Quiz{% endblock %}

{% block head_extra %}
  <style>
    .quiz-hero {
      position: relative;
      border-radius: .75rem;
      overflow: hidden;
      min-height: 200px;
      display: grid;
      place-items: center;
      padding: 2rem 1rem;
      background: #f5f7fb url("{{ url_for('static', filename='quiz_bg_placeholder.jpg') }}") center/cover no-repeat;
    }
    .quiz-hero::after {
      content: "";
      position: absolute; inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.25));
    }
    .quiz-hero > * { position: relative; z-index: 1; }

    /* Progress: green bar with yellow stars spanning the full width */
    .stars-wrap {
      position: relative;
      display: block;
      width: 100%;
      padding: .25rem 0;
    }
    .stars-rail {
      position: absolute; left: .75rem; right: .75rem; top: 50%;
      height: .45rem; transform: translateY(-50%);
      background: #e9f7ec;
      border-radius: .45rem;
      overflow: hidden;
    }
    .stars-fill {
      height: 100%; width: 0%;
      background: #27ae60;
      transition: width .25s ease;
    }
    .stars-row {
      display: flex; justify-content: space-between; align-items: center;
      width: 100%;
      position: relative;
      z-index: 1;
    }
    .star {
      width: 24px; height: 24px; flex: 0 0 auto;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,.2));
    }

    .question-card .list-group-item { cursor: pointer; }
    .question-card .list-group-item[aria-pressed="true"] { outline: 2px solid #198754; }

    /* Slightly larger text and stars on mobile */
    @media (max-width: 576px) {
      .quiz-hero h2 { font-size: 1.25rem; }
      .quiz-hero p { font-size: 1rem; }
      .question-card p { font-size: 1.05rem; }
      .list-group-item { font-size: 1.05rem; }
      .star { width: 30px; height: 30px; }
      .stars-rail { height: .5rem; border-radius: .5rem; }
    }
  </style>
{% endblock %}

{% block content %}
  <header class="mb-3 mb-md-4">
    <div class="d-flex align-items-center justify-content-between">
      <div>
        <h1 class="h4 mb-1">One tiny step before we cook üç≥</h1>
        <p class="text-muted mb-0">Solve this quick English mini-quiz to confirm your order.</p>
      </div>
      <a href="{{ url_for('home') }}" class="btn btn-outline-secondary d-none d-md-inline-flex">Back to Menu</a>
    </div>
  </header>

  <section id="quiz-hero" class="quiz-hero mb-4 text-white text-center rounded">
    <div class="container">
      <h2 class="h4 fw-semibold mb-2">Effort will be rewarded!</h2>
      <p class="mb-3">Your order will be sent automatically once you clear all the questions!</p>
      <button id="quiz-start" class="btn btn-light btn-lg px-4">Let‚Äôs go</button>
    </div>
  </section>

  <section id="quiz-root" class="d-none" aria-live="polite">
    <div class="card shadow-sm">
      <div class="card-body">
        <!-- Progress -->
        <div class="mb-3">
          <div class="stars-wrap">
            <div class="stars-rail" aria-hidden="true"><div class="stars-fill" id="stars-fill"></div></div>
            <div id="stars-row" class="stars-row"></div>
          </div>
          <div class="small text-muted" id="progress-text">0 / 0</div>
        </div>

        <!-- Question / Feedback -->
        <div id="question-zone"></div>

        <!-- Footer actions (no Next button; advance auto on correct) -->
        <div class="d-flex justify-content-end mt-3">
          <button id="btn-check" class="btn btn-success" disabled>Check answer</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Status area -->
  <div id="quiz-status" class="mt-3" aria-live="polite"></div>

  <!-- Server-provided quiz data -->
  <script id="quiz-data" type="application/json">{{ quiz|tojson }}</script>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script type="module" src="{{ url_for('static', filename='js/pages/quiz.js') }}"></script>
{% endblock %}
